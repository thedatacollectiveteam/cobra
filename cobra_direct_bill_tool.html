<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COBRA Direct Bill Implementation Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-button {
            flex: 1;
            padding: 15px 30px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .tab-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: white;
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            transform: scale(1.2);
        }

        .button-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            width: 100%;
        }

        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .output-section {
            margin-top: 30px;
            display: none;
        }

        .output-section.visible {
            display: block;
        }

        .output-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .mapper-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .mapper-table th,
        .mapper-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }

        .mapper-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .mapper-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .mapper-table tr.comment-row {
            background: #fff8dc;
        }

        .mapper-table tr.highlight-row {
            background: #e3f2fd;
        }

        .download-button {
            margin-top: 20px;
            background: #28a745;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .download-button:hover {
            background: #218838;
        }

        .flow-diagram {
            margin-top: 20px;
        }

        .flow-node {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            position: relative;
        }

        .flow-node.decision {
            background: #fff3cd;
            border-color: #ffc107;
        }

        .flow-node.action {
            background: #d4edda;
            border-color: #28a745;
        }

        .flow-node.variable {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .flow-node h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .flow-node ul {
            margin-left: 20px;
            color: #666;
        }

        .flow-connector {
            text-align: center;
            font-size: 1.5rem;
            color: #667eea;
            margin: 5px 0;
        }

        .logic-group {
            border-left: 3px solid #667eea;
            padding-left: 20px;
            margin: 20px 0;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .info-box h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box h4 {
            color: #f57c00;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß COBRA Direct Bill Implementation Tool</h1>
            <p>Simplify your direct bill mapper requirements and visualize logic flows</p>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('scenario')">üìã Scenario Generator</button>
            <button class="tab-button" onclick="switchTab('diagram')">üó∫Ô∏è Logic Diagram</button>
        </div>

        <!-- Scenario Generator Tab -->
        <div id="scenario-tab" class="tab-content active">
            <div class="card">
                <h2 style="color: #667eea; margin-bottom: 30px;">Client Requirements Form</h2>
                
                <div class="form-section">
                    <h2>Basic Configuration</h2>
                    
                    <div class="form-group">
                        <label>Implementation Type</label>
                        <select id="implementationType">
                            <option value="loa">Leave of Absence (LOA)</option>
                            <option value="retiree">Retiree</option>
                            <option value="both">LOA + Retiree</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Direct Bill Platform</label>
                        <select id="dbPlatform">
                            <option value="standard">Standard (DB 2.0 with Pay Schedules)</option>
                            <option value="db1">DB 1.0 (No Pay Schedules)</option>
                            <option value="grandfathered">Grandfathered (GF with Pay Schedules)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Benefits End Date</label>
                        <select id="benefitsEndDate">
                            <option value="eom">End of Month (FONM)</option>
                            <option value="termDate">Termination Date</option>
                        </select>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="usePaySchedules">
                        <label for="usePaySchedules">Client uses DB Pay Schedules</label>
                    </div>
                </div>

                <div class="form-section">
                    <h2>LOA Scenarios</h2>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="unpaidToPaid">
                        <label for="unpaidToPaid">Going from Unpaid LOA to Paid LOA</label>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="loaReturnBeforeDB">
                        <label for="loaReturnBeforeDB">Employees can return from LOA before Direct Bill starts</label>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Retiree Configuration</h2>
                    
                    <div class="form-group">
                        <label>Retiree Benefit Class Code (if applicable)</label>
                        <input type="text" id="retireeBenefitClass" placeholder="e.g., RET01">
                    </div>

                    <div class="form-group">
                        <label>Monthly Pay Frequency Code for Retirees</label>
                        <input type="text" id="monthlyPayFreq" placeholder="e.g., MONTHLY">
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="retireesOnFile">
                        <label for="retireesOnFile">Retirees continue to pass on file</label>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Dates Configuration</h2>
                    
                    <div class="form-group">
                        <label>Certifi Billing Start Date (for var_BillStartDate)</label>
                        <input type="date" id="billStartDate">
                    </div>

                    <div class="form-group">
                        <label>Conversion Type (if applicable)</label>
                        <select id="conversionType">
                            <option value="new">New Implementation</option>
                            <option value="wex">Wex Conversion (use previous wave go-live)</option>
                        </select>
                    </div>
                </div>

                <button class="button-primary" onclick="generateMapper()">üéØ Generate Filtered Mapper</button>

                <div id="output-section" class="output-section">
                    <h3>Generated Mapper Logic</h3>
                    <p style="color: #666; margin-bottom: 15px;">Below are the relevant mapper rows based on your requirements:</p>
                    
                    <div id="mapper-output"></div>
                    
                    <button class="download-button" onclick="downloadMapper()">‚¨áÔ∏è Download as Excel</button>
                </div>
            </div>
        </div>

        <!-- Logic Diagram Tab -->
        <div id="diagram-tab" class="tab-content">
            <div class="card">
                <h2 style="color: #667eea; margin-bottom: 30px;">COBRA Direct Bill Logic Flows</h2>
                
                <div class="info-box">
                    <h4>üìö How to Read This Diagram</h4>
                    <ul>
                        <li><strong style="color: #ffc107;">Yellow boxes</strong> = Decision points (conditions)</li>
                        <li><strong style="color: #28a745;">Green boxes</strong> = Actions (field mappings)</li>
                        <li><strong style="color: #2196f3;">Blue boxes</strong> = Variables being set</li>
                    </ul>
                </div>

                <div class="logic-group">
                    <h3 style="color: #667eea;">üîπ Identifier Map Logic Flow</h3>
                    
                    <div class="flow-node action">
                        <h4>1. Relation Mapping</h4>
                        <p><strong>Condition:</strong> Last Name Not Equal [blank]</p>
                        <p><strong>Action:</strong> Set Relation = E (Employee)</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>2. Pay Frequency Mapping</h4>
                        <p><strong>Important:</strong> Pay Frequency MUST be in field definitions</p>
                        <p><strong>Action:</strong> Map client-specific pay frequencies in ID Map</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node decision">
                        <h4>3. Pay Schedule Input Date - Employee Terminating</h4>
                        <p><strong>Condition:</strong> Logic for Employment Status = T</p>
                        <ul>
                            <li><strong>Benefits ‚Üí EOM:</strong> Pay Schedule Input Date = FONM(Termination Date)</li>
                            <li><strong>Benefits ‚Üí Term Date:</strong> Pay Schedule Input Date = ValueOf(Termination Date)</li>
                            <li><strong>Always:</strong> Pay Schedule Type = F</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>4. LOA Start for Direct Bill</h4>
                        <p><strong>Condition:</strong> Logic for going on LOA for Direct Bill</p>
                        <ul>
                            <li>Pay Schedule Input Date = ValueOf(LOA Start Date)</li>
                            <li>Pay Schedule Type = F</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>5. Unpaid to Paid LOA Transition (Optional)</h4>
                        <p><strong>Condition:</strong> Logic for going on LOA NOT for Direct Bill</p>
                        <ul>
                            <li>Pay Schedule Input Date = DateSubtract(D;1;LOA Start Date)</li>
                            <li>Pay Schedule Type = F</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>6. LOA End for Direct Bill</h4>
                        <p><strong>Condition:</strong> Logic for returning from LOA for Direct Bill</p>
                        <ul>
                            <li>Pay Schedule Input Date = ValueOf(LOA End Date)</li>
                            <li>Pay Schedule Type = F</li>
                        </ul>
                    </div>
                </div>

                <div class="logic-group">
                    <h3 style="color: #667eea;">üîπ Standard Map Logic - LOA Flow</h3>

                    <div class="warning-box">
                        <h4>‚ö†Ô∏è Key Dependencies</h4>
                        <p>Several variables are used throughout this logic:</p>
                        <ul>
                            <li><strong>var_DBTermComplete:</strong> Flags termination while on Direct Bill</li>
                            <li><strong>var_BillStartDate:</strong> Calculated from pay schedule dates</li>
                            <li><strong>var_DBTerm:</strong> Flags term scenarios</li>
                            <li><strong>var_UnpaidtoPaid:</strong> Flags unpaid ‚Üí paid LOA transition</li>
                            <li><strong>var_DBRescind:</strong> Flags rescinding Direct Bill</li>
                            <li><strong>var_DBStart:</strong> Determines DB start date timing</li>
                            <li><strong>var_DBEnd:</strong> Determines DB end date</li>
                            <li><strong>var_LOAOnDB:</strong> Maintains DB for ongoing LOA</li>
                        </ul>
                    </div>

                    <div class="flow-node variable">
                        <h4>Variable: var_DBTermComplete</h4>
                        <p><strong>Set When:</strong></p>
                        <ul>
                            <li>Current Direct Bill Start Date = [blank]</li>
                            <li>AND Logic for Employment Status = T</li>
                        </ul>
                        <p><strong>Purpose:</strong> Identifies complete termination from Direct Bill</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>Action: Clear Direct Bill for Termed Employee</h4>
                        <p><strong>When var_DBTermComplete = YES:</strong></p>
                        <ul>
                            <li>Pay Frequency = ValueOf(Current Pay Frequency)</li>
                            <li>LOA Status, LOA Pay Status, LOA Start Date = @@blank</li>
                            <li>LOA End Date = ValueOf(Termination Date)</li>
                            <li>Direct Bill Start Date, Type, End Date = @@blank</li>
                            <li>Direct Bill End Reason = ValueOf(Current)</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node variable">
                        <h4>Variable: var_BillStartDate</h4>
                        <p><strong>Set From:</strong> SQL query against PayScheduleDates table</p>
                        <p><strong>Purpose:</strong> Determines when Certifi billing starts based on pay schedule</p>
                        <p><strong>Logic:</strong> For each Pay Frequency, find the start date where @inputdate falls between start and end date</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node decision">
                        <h4>Scenario: Terming While on Direct Bill</h4>
                        <p><strong>Condition:</strong></p>
                        <ul>
                            <li>Current Direct Bill Start Date ‚â† [blank]</li>
                            <li>Current Direct Bill End Date = 9999-12-31</li>
                            <li>Employment Status = T</li>
                        </ul>
                        <p><strong>Sets:</strong> var_DBTerm = YES</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>Action: End Direct Bill on Termination</h4>
                        <p><strong>When var_DBTerm = YES:</strong></p>
                        <p><strong>If Pay End Date ‚â§ GreaterOf(Current DB Start Date; var_BillStartDate):</strong></p>
                        <ul>
                            <li>Direct Bill End Date = GreaterOf(Current DB Start Date; var_BillStartDate)</li>
                            <li>Direct Bill Type = 5</li>
                            <li>Direct Bill End Reason = 9</li>
                        </ul>
                        <p><strong>Otherwise:</strong></p>
                        <ul>
                            <li>Direct Bill End Date = ValueOf(Current Pay End Date)</li>
                            <li>Direct Bill End Reason = 5</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node variable">
                        <h4>Variable: var_UnpaidtoPaid</h4>
                        <p><strong>Set When:</strong></p>
                        <ul>
                            <li>Current LOA Status = Direct Bill LOA Status</li>
                            <li>Current Direct Bill End Date = 9999-12-31</li>
                            <li>Logic for going on LOA NOT for Direct Bill</li>
                        </ul>
                        <p><strong>Purpose:</strong> Flags transition from unpaid to paid LOA</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node decision">
                        <h4>Scenario: Rescind Direct Bill (Return Before DB Starts)</h4>
                        <p><strong>Conditions:</strong></p>
                        <ul>
                            <li>var_UnpaidtoPaid = YES</li>
                            <li>DateSubtract(D;1;LOA Start Date) ‚â§ GreaterOf(Current DB Start Date; var_BillStartDate)</li>
                        </ul>
                        <p><strong>OR:</strong></p>
                        <ul>
                            <li>Current DB Start Date ‚â† [blank]</li>
                            <li>Current DB End Date = 9999-12-31</li>
                            <li>Returning from LOA</li>
                            <li>LOA End Date ‚â§ GreaterOf(Current DB Start Date; var_BillStartDate)</li>
                        </ul>
                        <p><strong>Sets:</strong> var_DBRescind = YES</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>Action: Rescind Direct Bill</h4>
                        <p><strong>When var_DBRescind = YES:</strong></p>
                        <ul>
                            <li>Direct Bill Start Date = GreaterOf(Current DB Start; var_BillStartDate)</li>
                            <li>Direct Bill End Date = GreaterOf(Current DB Start; var_BillStartDate)</li>
                            <li>Direct Bill Type = 5</li>
                            <li>Direct Bill End Reason = 9</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node variable">
                        <h4>Variable: var_DBEnd</h4>
                        <p><strong>Set When:</strong> var_UnpaidtoPaid = YES</p>
                        <p><strong>Purpose:</strong> Flags ending Direct Bill when moving from Direct Bill LOA to non-Direct Bill LOA</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node variable">
                        <h4>Variable: var_LOAOnDB</h4>
                        <p><strong>Set When:</strong></p>
                        <ul>
                            <li>Current DB Start Date ‚â† [blank]</li>
                            <li>Current DB End Date = 9999-12-31</li>
                            <li>var_UnpaidtoPaid ‚â† YES</li>
                            <li>NOT returning from LOA for Direct Bill</li>
                        </ul>
                        <p><strong>Purpose:</strong> Maintain Direct Bill for ongoing LOA</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>Action: Retain Direct Bill</h4>
                        <p><strong>When var_LOAOnDB = YES:</strong></p>
                        <ul>
                            <li>Direct Bill Start Date = GreaterOf(Current DB Start; var_BillStartDate)</li>
                            <li>Direct Bill Type = ValueOf(Current DB Type)</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node variable">
                        <h4>Variable: var_DBStart</h4>
                        <p><strong>Set When:</strong> Logic for going on LOA for Direct Bill</p>
                        <p><strong>Values:</strong></p>
                        <ul>
                            <li><strong>CurrentStartDate:</strong> If LOA Start Date = DateAdd(D;1;Previous Pay End Date) AND DateAdd(D;1;Previous Pay End Date) ‚â§ Current Date</li>
                            <li><strong>NextStartDate:</strong> If LOA Start Date ‚â† DateAdd(D;1;Previous Pay End Date) AND DateAdd(D;1;Current Pay End Date) ‚â§ Current Date</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>Action: Start Direct Bill for LOA</h4>
                        <p><strong>If var_DBStart = CurrentStartDate:</strong></p>
                        <ul>
                            <li>Direct Bill Start Date = GreaterOf(var_BillStartDate; DateAdd(D;1;Previous Pay End Date))</li>
                            <li>Direct Bill Type = 2</li>
                        </ul>
                        <p><strong>If var_DBStart = NextStartDate:</strong></p>
                        <ul>
                            <li>Direct Bill Start Date = GreaterOf(var_BillStartDate; DateAdd(D;1;Current Pay End Date))</li>
                            <li>Direct Bill Type = 2</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node variable">
                        <h4>Variable: var_DBEnd (LOA Return)</h4>
                        <p><strong>Set When:</strong></p>
                        <ul>
                            <li>Logic for returning from LOA for Direct Bill</li>
                            <li>Current DB Start Date ‚â† [blank]</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>Action: End Direct Bill on LOA Return</h4>
                        <p><strong>When var_DBEnd = YES:</strong></p>
                        <ul>
                            <li>Direct Bill End Date = ValueOf(Current Pay End Date)</li>
                            <li>Direct Bill End Reason = 3</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>Cleanup: Clear Previous End Reason</h4>
                        <p><strong>When:</strong> Going back on Direct Bill after previously returning</p>
                        <p><strong>Action:</strong> Direct Bill End Reason = @@blank</p>
                        <p><strong>Note:</strong> Requires "Overwrite with Blank" transformation enabled</p>
                    </div>
                </div>

                <div class="logic-group">
                    <h3 style="color: #667eea;">üîπ Retiree Direct Bill Flow</h3>

                    <div class="flow-node variable">
                        <h4>Variable: var_Retiree</h4>
                        <p><strong>Set When:</strong> Logic for Retiree for Direct Bill</p>
                        <p><strong>Purpose:</strong> Identifies new retirees needing Direct Bill</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>Action: Set Retiree Direct Bill</h4>
                        <p><strong>When var_Retiree = YES:</strong></p>
                        <ul>
                            <li>Employment Status = R</li>
                            <li>Employment Status Effective Date = FONM(Term Date) or DateAdd(D;1;Term Date)</li>
                            <li>Benefit Class Code = [Client-specific Retiree class]</li>
                            <li>Direct Bill Start Date = GreaterOf(FONM(Term Date); var_RetireeBillStartDate)</li>
                            <li>Direct Bill Type = 1</li>
                            <li>Pay Frequency = [Monthly code]</li>
                            <li>Termination Date/Reason = @@blank</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node variable">
                        <h4>Variable: var_RetireeOnDB</h4>
                        <p><strong>Set When:</strong></p>
                        <ul>
                            <li>Current DB Start Date ‚â† [blank]</li>
                            <li>Current Employment Status = R</li>
                            <li>File logic for Employment Status = R</li>
                        </ul>
                        <p><strong>Purpose:</strong> Maintain Direct Bill for existing retirees</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>Action: Retain Retiree Direct Bill</h4>
                        <p><strong>When var_RetireeOnDB = Yes:</strong></p>
                        <ul>
                            <li>Termination Date/Reason = @@blank</li>
                            <li>Direct Bill Start Date = ValueOf(Current DB Start Date)</li>
                            <li>Direct Bill Type = ValueOf(Current DB Type)</li>
                            <li>Pay Frequency = ValueOf(Current Pay Frequency)</li>
                            <li>Pay Frequency Effective Date = ValueOf(Current)</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node decision">
                        <h4>Scenario: Retiree Rehire (Rescind)</h4>
                        <p><strong>Conditions:</strong></p>
                        <ul>
                            <li>Current DB Start Date ‚â† [blank]</li>
                            <li>Current Employment Status = R</li>
                            <li>Logic for returning to Active Employment Status</li>
                            <li>Re-hire Date ‚â† [blank]</li>
                            <li>Re-hire Date ‚â§ Current DB Start Date</li>
                        </ul>
                        <p><strong>Sets:</strong> var_DBRescind = YES</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>Action: Rescind Retiree Direct Bill</h4>
                        <p><strong>When var_DBRescind = YES:</strong></p>
                        <ul>
                            <li>Direct Bill End Date = ValueOf(Current DB Start Date)</li>
                            <li>Direct Bill Type = 5</li>
                            <li>Direct Bill End Reason = 9</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node variable">
                        <h4>Variable: var_RetireeRehire</h4>
                        <p><strong>Set When:</strong></p>
                        <ul>
                            <li>Current DB Start Date ‚â† [blank]</li>
                            <li>Current Employment Status = R</li>
                            <li>Logic for returning to Active Employment Status (normal rehire)</li>
                        </ul>
                        <p><strong>Purpose:</strong> End Direct Bill for retiree rehire</p>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>Action: End Direct Bill on Rehire</h4>
                        <p><strong>When var_RetireeRehire = YES:</strong></p>
                        <ul>
                            <li>Direct Bill End Date = DateSubtract(D;1;Re-hire Date)</li>
                            <li>Direct Bill End Reason = 3</li>
                            <li>Pay Frequency Effective Date = Re-hire Date</li>
                        </ul>
                    </div>
                </div>

                <div class="logic-group">
                    <h3 style="color: #667eea;">üîπ DB 1.0 Differences</h3>

                    <div class="info-box">
                        <h4>üìù Key Differences for DB 1.0</h4>
                        <ul>
                            <li><strong>No Pay Schedules:</strong> DB 1.0 doesn't use pay schedule logic</li>
                            <li><strong>Identifier Map:</strong> No changes needed to ID Map</li>
                            <li><strong>Simpler Date Logic:</strong> Direct Bill Start Date = FONM(LOA Start Date)</li>
                            <li><strong>End Date:</strong> Direct Bill End Date = EOM(LOA End Date)</li>
                            <li><strong>No var_BillStartDate:</strong> This variable is not used in DB 1.0</li>
                        </ul>
                    </div>

                    <div class="flow-node action">
                        <h4>DB 1.0: LOA Start Logic</h4>
                        <p><strong>When:</strong> Logic for going on LOA for Direct Bill</p>
                        <p><strong>Action:</strong></p>
                        <ul>
                            <li>Direct Bill Start Date = FONM(LOA Start Date)</li>
                            <li>Direct Bill Type = 2</li>
                        </ul>
                    </div>

                    <div class="flow-connector">‚Üì</div>

                    <div class="flow-node action">
                        <h4>DB 1.0: LOA End Logic</h4>
                        <p><strong>When:</strong> Logic for returning from LOA for Direct Bill</p>
                        <p><strong>Action:</strong></p>
                        <ul>
                            <li>Direct Bill End Date = EOM(LOA End Date)</li>
                            <li>Direct Bill End Reason = 3</li>
                        </ul>
                    </div>
                </div>

                <div class="warning-box">
                    <h4>‚ö†Ô∏è Implementation Checklist</h4>
                    <ol>
                        <li>Update all cells highlighted in <strong>blue</strong></li>
                        <li>Remove all rows highlighted in <strong>green</strong> before moving to Prod</li>
                        <li>If NOT using DB Pay Schedules, remove rows where Demographic is highlighted in <strong>orange</strong></li>
                        <li>If NO "Unpaid to Paid LOA" scenario, remove rows where Demographic is highlighted in <strong>red</strong></li>
                        <li>Ensure Pay Frequency is in Field Definitions (required for Pay Schedule Input Date function)</li>
                        <li>Run var_BillStartDate SQL query and populate in Standard Map</li>
                        <li>Enable "Overwrite with Blank" transformation if using Direct Bill End Reason cleanup</li>
                        <li>For Retiree implementations: verify benefit class code and monthly pay frequency code</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        function generateMapper() {
            const implementationType = document.getElementById('implementationType').value;
            const dbPlatform = document.getElementById('dbPlatform').value;
            const benefitsEndDate = document.getElementById('benefitsEndDate').value;
            const usePaySchedules = document.getElementById('usePaySchedules').checked;
            const unpaidToPaid = document.getElementById('unpaidToPaid').checked;
            const loaReturnBeforeDB = document.getElementById('loaReturnBeforeDB').checked;
            
            let mapperHTML = '<div class="mapper-output">';
            
            // Generate summary
            mapperHTML += '<div class="info-box">';
            mapperHTML += '<h4>üìä Configuration Summary</h4>';
            mapperHTML += '<ul>';
            mapperHTML += `<li><strong>Implementation Type:</strong> ${implementationType.toUpperCase()}</li>`;
            mapperHTML += `<li><strong>Platform:</strong> ${dbPlatform === 'standard' ? 'DB 2.0 (Standard)' : dbPlatform === 'db1' ? 'DB 1.0' : 'Grandfathered'}</li>`;
            mapperHTML += `<li><strong>Benefits End:</strong> ${benefitsEndDate === 'eom' ? 'End of Month' : 'Termination Date'}</li>`;
            mapperHTML += `<li><strong>Pay Schedules:</strong> ${usePaySchedules ? 'Yes' : 'No'}</li>`;
            mapperHTML += `<li><strong>Unpaid to Paid LOA:</strong> ${unpaidToPaid ? 'Yes' : 'No'}</li>`;
            mapperHTML += '</ul>';
            mapperHTML += '</div>';
            
            // Identifier Map Section
            if (dbPlatform !== 'db1') {
                mapperHTML += '<h4>üîπ Identifier Map Logic</h4>';
                mapperHTML += '<table class="mapper-table">';
                mapperHTML += '<thead><tr><th>Type</th><th>Field Name</th><th>Operator</th><th>From Value</th><th>Destination Field</th><th>To Value</th><th>And</th></tr></thead>';
                mapperHTML += '<tbody>';
                
                // Relation mapping
                mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Relation Mapping</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>Last Name</td><td>Not Equal</td><td></td><td>Relation</td><td>E</td><td></td></tr>';
                
                // Pay Frequency mapping
                mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Pay Frequency Mapping (Move to ID Map)</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td colspan="6">Pay Frequency Mapping [Client-specific values]</td></tr>';
                
                if (usePaySchedules) {
                    // Pay Schedule Input Date logic
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Setting Pay Schedule Input Date</td></tr>';
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Employee is terminating</td></tr>';
                    
                    if (benefitsEndDate === 'eom') {
                        mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>Logic for Employment Status of T</td><td></td><td></td><td>Pay Schedule Input Date</td><td>FONM(Date used for Termination Date)</td><td></td></tr>';
                    } else {
                        mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>Logic for Employment Status of T</td><td></td><td></td><td>Pay Schedule Input Date</td><td>ValueOf(Date used for Termination Date)</td><td></td></tr>';
                    }
                    mapperHTML += '<tr><td>Demographic</td><td>Logic for Employment Status of T</td><td></td><td></td><td>Pay Schedule Type</td><td>F</td><td></td></tr>';
                    
                    if (implementationType === 'loa' || implementationType === 'both') {
                        // LOA Start for Direct Bill
                        mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####LOA Start for Direct Bill</td></tr>';
                        mapperHTML += '<tr><td>Demographic</td><td>Logic for going on LOA for Direct Bill</td><td></td><td></td><td>Pay Schedule Input Date</td><td>ValueOf(Date used for LOA Start Date)</td><td></td></tr>';
                        mapperHTML += '<tr><td>Demographic</td><td>Logic for going on LOA for Direct Bill</td><td></td><td></td><td>Pay Schedule Type</td><td>F</td><td></td></tr>';
                        
                        if (unpaidToPaid) {
                            // Unpaid to Paid transition
                            mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Going from Unpaid LOA to Paid LOA</td></tr>';
                            mapperHTML += '<tr><td>Demographic</td><td>Logic for going on LOA NOT for Direct Bill</td><td></td><td></td><td>Pay Schedule Input Date</td><td>DateSubtract(D;1;Date used for LOA Start Date)</td><td></td></tr>';
                            mapperHTML += '<tr><td>Demographic</td><td>Logic for going on LOA NOT for Direct Bill</td><td></td><td></td><td>Pay Schedule Type</td><td>F</td><td></td></tr>';
                        }
                        
                        // LOA End for Direct Bill
                        mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####LOA End for Direct Bill</td></tr>';
                        mapperHTML += '<tr><td>Demographic</td><td>Logic for returning from LOA for Direct Bill</td><td></td><td></td><td>Pay Schedule Input Date</td><td>ValueOf(Date used for LOA End Date)</td><td></td></tr>';
                        mapperHTML += '<tr><td>Demographic</td><td>Logic for returning from LOA for Direct Bill</td><td></td><td></td><td>Pay Schedule Type</td><td>F</td><td></td></tr>';
                    }
                }
                
                mapperHTML += '</tbody></table>';
            }
            
            // Standard Map Logic - LOA
            if (implementationType === 'loa' || implementationType === 'both') {
                mapperHTML += '<h4 style="margin-top: 30px;">üîπ Standard Map Logic - LOA</h4>';
                mapperHTML += '<table class="mapper-table">';
                mapperHTML += '<thead><tr><th>Type</th><th>Field Name</th><th>Operator</th><th>From Value</th><th>Destination Field</th><th>To Value</th><th>And</th></tr></thead>';
                mapperHTML += '<tbody>';
                
                // var_DBTermComplete
                mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Incorporate into client\'s LOA Logic</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill Start Date</td><td>Equals</td><td></td><td>var_DBTermComplete</td><td>YES</td><td>Y</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>Logic for Employment Status of T</td><td></td><td></td><td></td><td></td><td></td></tr>';
                
                // Clear fields when terminated
                mapperHTML += '<tr><td>Demographic</td><td>var_DBTermComplete</td><td>Equals</td><td>YES</td><td>Pay Frequency</td><td>ValueOf(Current Pay Frequency)</td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_DBTermComplete</td><td>Equals</td><td>YES</td><td>LOA Status</td><td>@@blank</td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_DBTermComplete</td><td>Equals</td><td>YES</td><td>LOA Start Date</td><td>@@blank</td><td></td></tr>';
                
                if (dbPlatform === 'standard') {
                    // var_BillStartDate section
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Certifi Billing Start Date Variables</td></tr>';
                    mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>Pay Frequency</td><td>Equals</td><td>[From SQL]</td><td>var_BillStartDate</td><td>[MM/DD/YYYY]</td><td></td></tr>';
                    
                    // var_DBTerm
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Terming while on Direct Bill</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill Start Date</td><td>Not Equal</td><td></td><td>var_DBTerm</td><td>YES</td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill End Date</td><td>IN</td><td>Dec 31 9999 11:59PM;12/31/9999</td><td></td><td></td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Logic for Employment Status of T</td><td></td><td></td><td></td><td></td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBTerm</td><td>Equals</td><td>YES</td><td>Direct Bill End Date</td><td>GreaterOf(Current Direct Bill Start Date;var_BillStartDate)</td><td>Y</td></tr>';
                    
                    if (unpaidToPaid) {
                        // var_UnpaidtoPaid
                        mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Setting variable for moving from unpaid to paid LOA scenarios</td></tr>';
                        mapperHTML += '<tr><td>Demographic</td><td>Current LOA Status</td><td>Equals or IN</td><td>LOA Status that is Direct Bill</td><td>var_UnpaidtoPaid</td><td>YES</td><td>Y</td></tr>';
                        mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill End Date</td><td>IN</td><td>Dec 31 9999 11:59PM;12/31/9999</td><td></td><td></td><td>Y</td></tr>';
                        mapperHTML += '<tr><td>Demographic</td><td>Logic for going on LOA NOT for Direct Bill</td><td></td><td></td><td></td><td></td><td></td></tr>';
                        
                        if (loaReturnBeforeDB) {
                            // var_DBRescind
                            mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Rescind Direct Bill</td></tr>';
                            mapperHTML += '<tr><td>Demographic</td><td>var_UnpaidtoPaid</td><td>Equals</td><td>YES</td><td>var_DBRescind</td><td>YES</td><td>Y</td></tr>';
                            mapperHTML += '<tr><td>Demographic</td><td>DateSubtract(D;1;Date used for LOA Start Date)</td><td>Less Than or Equal to</td><td>GreaterOf(Current Direct Bill Start Date;var_BillStartDate)</td><td></td><td></td><td></td></tr>';
                            mapperHTML += '<tr><td>Demographic</td><td>var_DBRescind</td><td>Equals</td><td>YES</td><td>Direct Bill Start Date</td><td>GreaterOf(Current Direct Bill Start Date;var_BillStartDate)</td><td></td></tr>';
                            mapperHTML += '<tr><td>Demographic</td><td>var_DBRescind</td><td>Equals</td><td>YES</td><td>Direct Bill End Date</td><td>GreaterOf(Current Direct Bill Start Date;var_BillStartDate)</td><td></td></tr>';
                            mapperHTML += '<tr><td>Demographic</td><td>var_DBRescind</td><td>Equals</td><td>YES</td><td>Direct Bill Type</td><td>5</td><td></td></tr>';
                            mapperHTML += '<tr><td>Demographic</td><td>var_DBRescind</td><td>Equals</td><td>YES</td><td>Direct Bill End Reason</td><td>9</td><td></td></tr>';
                        }
                        
                        // var_DBEnd
                        mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Going from LOA for Direct Bill to an LOA NOT for Direct Bill</td></tr>';
                        mapperHTML += '<tr><td>Demographic</td><td>var_UnpaidtoPaid</td><td>Equals</td><td>YES</td><td>var_DBEnd</td><td>YES</td><td></td></tr>';
                    }
                    
                    // var_LOAOnDB
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Retain Direct Bill for LOA on Direct Bill</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill Start Date</td><td>Not Equal</td><td></td><td>var_LOAOnDB</td><td>YES</td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill End Date</td><td>IN</td><td>Dec 31 9999 11:59PM;12/31/9999</td><td></td><td></td><td>Y</td></tr>';
                    if (unpaidToPaid) {
                        mapperHTML += '<tr><td>Demographic</td><td>var_UnpaidtoPaid</td><td>Not Equal</td><td>YES</td><td></td><td></td><td>Y</td></tr>';
                    }
                    mapperHTML += '<tr><td>Demographic</td><td>Logic for returning from LOA for Direct Bill is not true</td><td></td><td></td><td></td><td></td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_LOAOnDB</td><td>Equals</td><td>YES</td><td>Direct Bill Start Date</td><td>GreaterOf(Current Direct Bill Start Date;var_BillStartDate)</td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_LOAOnDB</td><td>Equals</td><td>YES</td><td>Direct Bill Type</td><td>ValueOf(Current Direct Bill Type)</td><td></td></tr>';
                    
                    // var_DBStart
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####LOA Start for Direct Bill Variable</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Logic for going on LOA for Direct Bill</td><td></td><td></td><td>var_DBStart</td><td>CurrentStartDate</td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Date used for LOA Start Date</td><td>Equals</td><td>DateAdd(D;1;Previous Pay End Date)</td><td></td><td></td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>DateAdd(D;1;Previous Pay End Date)</td><td>Less Than or Equal to</td><td>ValueOf(Current Date)</td><td></td><td></td><td></td></tr>';
                    
                    mapperHTML += '<tr><td>Demographic</td><td>Logic for going on LOA for Direct Bill</td><td></td><td></td><td>var_DBStart</td><td>NextStartDate</td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Date used for LOA Start Date</td><td>Not Equal</td><td>DateAdd(D;1;Previous Pay End Date)</td><td></td><td></td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>DateAdd(D;1;Current Pay End Date)</td><td>Less Than or Equal to</td><td>ValueOf(Current Date)</td><td></td><td></td><td></td></tr>';
                    
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####LOA Start for Direct Bill Current Pay Start Date</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBStart</td><td>Equals</td><td>CurrentStartDate</td><td>Direct Bill Start Date</td><td>GreaterOf(var_BillStartDate;DateAdd(D;1;Previous Pay End Date))</td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBStart</td><td>Equals</td><td>CurrentStartDate</td><td>Direct Bill Type</td><td>2</td><td></td></tr>';
                    
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####LOA Start for Direct Bill Next Pay Start Date</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBStart</td><td>Equals</td><td>NextStartDate</td><td>Direct Bill Start Date</td><td>GreaterOf(var_BillStartDate;DateAdd(D;1;Current Pay End Date))</td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBStart</td><td>Equals</td><td>NextStartDate</td><td>Direct Bill Type</td><td>2</td><td></td></tr>';
                    
                    // var_DBEnd (return)
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####LOA End for Direct Bill Variable</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Logic for returning from LOA for Direct Bill</td><td></td><td></td><td>var_DBEnd</td><td>YES</td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill Start Date</td><td>Not Equal</td><td></td><td></td><td></td><td></td></tr>';
                    
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####LOA End for Direct Bill Current Pay End Date</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBEnd</td><td>Equals</td><td>YES</td><td>Direct Bill End Date</td><td>ValueOf(Current Pay End Date)</td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBEnd</td><td>Equals</td><td>YES</td><td>Direct Bill End Reason</td><td>3</td><td></td></tr>';
                    
                    // Cleanup
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Going on Direct Bill after having already once returned from Direct Bill</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBStart</td><td>IN</td><td>CurrentStartDate;NextStartDate</td><td>Direct Bill End Reason</td><td>@@blank</td><td></td></tr>';
                    
                } else if (dbPlatform === 'db1') {
                    // DB 1.0 specific logic
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Terming while on Direct Bill (DB 1.0)</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill Start Date</td><td>Not Equal</td><td></td><td>var_DBTerm</td><td>YES</td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill End Date</td><td>IN</td><td>Dec 31 9999 11:59PM;12/31/9999</td><td></td><td></td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Logic for Employment Status of T</td><td></td><td></td><td></td><td></td><td></td></tr>';
                    
                    if (benefitsEndDate === 'eom') {
                        mapperHTML += '<tr><td>Demographic</td><td>var_DBTerm</td><td>Equals</td><td>YES</td><td>Direct Bill End Date</td><td>EOM(Date used for Termination Date)</td><td></td></tr>';
                    } else {
                        mapperHTML += '<tr><td>Demographic</td><td>var_DBTerm</td><td>Equals</td><td>YES</td><td>Direct Bill End Date</td><td>ValueOf(Date used for Termination Date)</td><td></td></tr>';
                    }
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBTerm</td><td>Equals</td><td>YES</td><td>Direct Bill End Reason</td><td>5</td><td></td></tr>';
                    
                    // LOA Start for DB 1.0
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####LOA Start for Direct Bill Variable (DB 1.0)</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Logic for going on LOA for Direct Bill</td><td></td><td></td><td>var_DBStart</td><td>DBStartDate</td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBStart</td><td>Equals</td><td>DBStartDate</td><td>Direct Bill Start Date</td><td>FONM(field for LOA Start Date)</td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBStart</td><td>Equals</td><td>DBStartDate</td><td>Direct Bill Type</td><td>2</td><td></td></tr>';
                    
                    // LOA End for DB 1.0
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####LOA End for Direct Bill Variable (DB 1.0)</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Logic for returning from LOA for Direct Bill</td><td></td><td></td><td>var_DBEnd</td><td>YES</td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill Start Date</td><td>Not Equal</td><td></td><td></td><td></td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBEnd</td><td>Equals</td><td>YES</td><td>Direct Bill End Date</td><td>EOM(field for LOA End Date)</td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBEnd</td><td>Equals</td><td>YES</td><td>Direct Bill End Reason</td><td>3</td><td></td></tr>';
                }
                
                mapperHTML += '</tbody></table>';
            }
            
            // Retiree logic
            if (implementationType === 'retiree' || implementationType === 'both') {
                mapperHTML += '<h4 style="margin-top: 30px;">üîπ Standard Map Logic - Retiree</h4>';
                mapperHTML += '<table class="mapper-table">';
                mapperHTML += '<thead><tr><th>Type</th><th>Field Name</th><th>Operator</th><th>From Value</th><th>Destination Field</th><th>To Value</th><th>And</th></tr></thead>';
                mapperHTML += '<tbody>';
                
                if (loaReturnBeforeDB) {
                    // Rescind Retiree Direct Bill
                    mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Rescind Retiree Direct Bill</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill Start Date</td><td>Not Equal</td><td></td><td>var_DBRescind</td><td>YES</td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Current Employment Status</td><td>Equals</td><td>R</td><td></td><td></td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Logic for returning to an Active Employment Status</td><td></td><td></td><td></td><td></td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Date used for Re-hire Date</td><td>Not Equal</td><td></td><td></td><td></td><td>Y</td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>Date used for Re-hire Date</td><td>Less Than or equal to</td><td>ValueOf(Current Direct Bill Start Date)</td><td></td><td></td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBRescind</td><td>Equals</td><td>YES</td><td>Direct Bill End Date</td><td>ValueOf(Current Direct Bill Start Date)</td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBRescind</td><td>Equals</td><td>YES</td><td>Direct Bill Type</td><td>5</td><td></td></tr>';
                    mapperHTML += '<tr><td>Demographic</td><td>var_DBRescind</td><td>Equals</td><td>YES</td><td>Direct Bill End Reason</td><td>9</td><td></td></tr>';
                }
                
                // Retain Retiree DB
                mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Retain Direct Bill and Pay Frequency for Retirees on Direct Bill</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill Start Date</td><td>Not Equal</td><td></td><td>var_RetireeOnDB</td><td>Yes</td><td>Y</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>Current Employment Status</td><td>Equals</td><td>R</td><td></td><td></td><td>Y</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>File logic for Employment Status of R</td><td></td><td></td><td></td><td></td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_RetireeOnDB</td><td>Equals</td><td>Yes</td><td>Termination Date</td><td>@@blank</td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_RetireeOnDB</td><td>Equals</td><td>Yes</td><td>Termination Reason</td><td>@@blank</td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_RetireeOnDB</td><td>Equals</td><td>Yes</td><td>Direct Bill Start Date</td><td>ValueOf(Current Direct Bill Start Date)</td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_RetireeOnDB</td><td>Equals</td><td>Yes</td><td>Direct Bill Type</td><td>ValueOf(Current Direct Bill Type)</td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_RetireeOnDB</td><td>Equals</td><td>Yes</td><td>Pay Frequency</td><td>ValueOf(Current Pay Frequency)</td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_RetireeOnDB</td><td>Equals</td><td>Yes</td><td>Pay Frequency Effective Date</td><td>ValueOf(Current Pay Frequency Effective Date)</td><td></td></tr>';
                
                // Retiree Direct Bill Start
                mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Retiree Direct Bill Start</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>Logic for Retiree for Direct Bill</td><td></td><td></td><td>var_Retiree</td><td>YES</td><td></td></tr>';
                mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Employment Status</td><td>R</td><td></td></tr>';
                
                if (benefitsEndDate === 'eom') {
                    mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Employment Status Effective Date</td><td>FONM(Date used for Termination Date)</td><td></td></tr>';
                    mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Benefit Class Effective Date</td><td>FONM(Date used for Termination Date)</td><td></td></tr>';
                    mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Direct Bill Start Date</td><td>GreaterOf(FONM(Date used for Termination Date);var_RetireeBillStartDate)</td><td></td></tr>';
                    mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Pay Frequency Effective Date</td><td>FONM(Date used for Termination Date)</td><td></td></tr>';
                } else {
                    mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Employment Status Effective Date</td><td>DateAdd(D;1;Date used for Termination Date)</td><td></td></tr>';
                    mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Benefit Class Effective Date</td><td>DateAdd(D;1;Date used for Termination Date)</td><td></td></tr>';
                    mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Direct Bill Start Date</td><td>GreaterOf(DateAdd(D;1;Date used for Termination Date);var_RetireeBillStartDate)</td><td></td></tr>';
                    mapperHTML += '<tr class="highlight-row"><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Pay Frequency Effective Date</td><td>DateAdd(D;1;Date used for Termination Date)</td><td></td></tr>';
                }
                
                const benefitClass = document.getElementById('retireeBenefitClass').value || '[Client-provided Benefit Class Code]';
                const monthlyFreq = document.getElementById('monthlyPayFreq').value || '[Monthly Pay Frequency Code]';
                
                mapperHTML += `<tr class="highlight-row"><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Benefit Class Code</td><td>${benefitClass}</td><td></td></tr>`;
                mapperHTML += '<tr><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Termination Date</td><td>@@blank</td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Termination Reason</td><td>@@blank</td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Direct Bill Type</td><td>1</td><td></td></tr>';
                mapperHTML += `<tr class="highlight-row"><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Pay Frequency</td><td>${monthlyFreq}</td><td></td></tr>`;
                
                // Retiree Direct Bill End
                mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Retiree Direct Bill End</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>Current Direct Bill Start Date</td><td>Not Equal</td><td></td><td>var_RetireeRehire</td><td>YES</td><td>Y</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>Current Employment Status</td><td>Equals</td><td>R</td><td></td><td></td><td>Y</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>Logic for returning to an Active Employment Status</td><td></td><td></td><td></td><td></td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_RetireeRehire</td><td>Equals</td><td>YES</td><td>Direct Bill End Date</td><td>DateSubtract(D;1;Date used for Re-hire Date)</td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_RetireeRehire</td><td>Equals</td><td>YES</td><td>Direct Bill End Reason</td><td>3</td><td></td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_RetireeRehire</td><td>Equals</td><td>YES</td><td>Pay Frequency Effective Date</td><td>Date used for Re-hire Date</td><td></td></tr>';
                
                // Cleanup
                mapperHTML += '<tr class="comment-row"><td>Comment</td><td colspan="6">####Going on Direct Bill after having already once returned from Direct Bill</td></tr>';
                mapperHTML += '<tr><td>Demographic</td><td>var_Retiree</td><td>Equals</td><td>Yes</td><td>Direct Bill End Reason</td><td>@@blank</td><td></td></tr>';
                
                mapperHTML += '</tbody></table>';
            }
            
            // Add implementation notes
            mapperHTML += '<div class="warning-box" style="margin-top: 30px;">';
            mapperHTML += '<h4>üìã Implementation Checklist</h4>';
            mapperHTML += '<ol>';
            mapperHTML += '<li>Review all <strong>highlighted</strong> rows and update with client-specific values</li>';
            mapperHTML += '<li>Replace placeholder values (e.g., [Client-provided]) with actual values</li>';
            if (dbPlatform === 'standard') {
                mapperHTML += '<li>Run the var_BillStartDate SQL query and populate results</li>';
            }
            mapperHTML += '<li>Ensure Pay Frequency is in Field Definitions</li>';
            mapperHTML += '<li>Enable "Overwrite with Blank" transformation for Direct Bill End Reason</li>';
            mapperHTML += '<li>Update "Logic for Employment Status", "Logic for going on LOA", etc. with actual field logic</li>';
            mapperHTML += '<li>Test all scenarios in unit testing environment</li>';
            mapperHTML += '</ol>';
            mapperHTML += '</div>';
            
            mapperHTML += '</div>';
            
            document.getElementById('mapper-output').innerHTML = mapperHTML;
            document.getElementById('output-section').classList.add('visible');
            
            // Scroll to output
            document.getElementById('output-section').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function downloadMapper() {
            // This would ideally generate an actual Excel file
            // For now, we'll create a downloadable HTML version
            alert('Excel download functionality would be implemented here. For now, you can copy the table content or print this page.');
        }
    </script>
</body>
</html>
